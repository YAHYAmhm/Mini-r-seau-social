{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport api from '../../services/api';\nexport const fetchPosts = createAsyncThunk('posts/fetchPosts', async () => {\n  const [postsResponse, usersResponse] = await Promise.all([api.get('/posts'), api.get('/users')]);\n  const posts = postsResponse.data;\n  const users = usersResponse.data;\n  return posts.map(post => ({\n    ...post,\n    user: users.find(u => String(u.id) === String(post.userId))\n  }));\n});\nexport const createPost = createAsyncThunk('posts/createPost', async (newPost, {\n  getState\n}) => {\n  const response = await api.post('/posts', newPost);\n  const currentUser = getState().auth.currentUser;\n  return {\n    ...response.data,\n    user: currentUser\n  };\n});\nexport const updatePost = createAsyncThunk('posts/updatePost', async ({\n  id,\n  data\n}) => {\n  const response = await api.patch(`/posts/${id}`, data);\n  return response.data;\n});\nexport const deletePost = createAsyncThunk('posts/deletePost', async id => {\n  await api.delete(`/posts/${id}`);\n  return id;\n});\nexport const toggleLike = createAsyncThunk('posts/toggleLike', async ({\n  postId,\n  userId\n}, {\n  getState\n}) => {\n  const state = getState();\n  const post = state.posts.items.find(p => p.id === postId);\n  let newLikes = [...post.likes];\n  if (newLikes.includes(userId)) {\n    newLikes = newLikes.filter(id => id !== userId);\n  } else {\n    newLikes.push(userId);\n  }\n  const response = await api.patch(`/posts/${postId}`, {\n    likes: newLikes\n  });\n  return response.data;\n});\nconst postsSlice = createSlice({\n  name: 'posts',\n  initialState: {\n    items: [],\n    status: 'idle',\n    error: null\n  },\n  reducers: {},\n  extraReducers: builder => {\n    builder.addCase(fetchPosts.pending, state => {\n      state.status = 'loading';\n    }).addCase(fetchPosts.fulfilled, (state, action) => {\n      state.status = 'succeeded';\n      state.items = action.payload;\n    }).addCase(fetchPosts.rejected, (state, action) => {\n      state.status = 'failed';\n      state.error = action.error.message;\n    }).addCase(createPost.fulfilled, (state, action) => {\n      state.items.unshift(action.payload);\n    }).addCase(updatePost.fulfilled, (state, action) => {\n      const index = state.items.findIndex(p => p.id === action.payload.id);\n      if (index !== -1) {\n        state.items[index] = {\n          ...state.items[index],\n          ...action.payload\n        };\n      }\n    }).addCase(deletePost.fulfilled, (state, action) => {\n      state.items = state.items.filter(p => p.id !== action.payload);\n    }).addCase(toggleLike.fulfilled, (state, action) => {\n      const index = state.items.findIndex(p => p.id === action.payload.id);\n      if (index !== -1) state.items[index].likes = action.payload.likes;\n    });\n  }\n});\n\n// Selectors\nexport const selectAllPosts = state => state.posts.items;\nexport default postsSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","api","fetchPosts","postsResponse","usersResponse","Promise","all","get","posts","data","users","map","post","user","find","u","String","id","userId","createPost","newPost","getState","response","currentUser","auth","updatePost","patch","deletePost","delete","toggleLike","postId","state","items","p","newLikes","likes","includes","filter","push","postsSlice","name","initialState","status","error","reducers","extraReducers","builder","addCase","pending","fulfilled","action","payload","rejected","message","unshift","index","findIndex","selectAllPosts","reducer"],"sources":["C:/Users/hp/react_container/Mini-r-seau-social/src/features/posts/postsSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport api from '../../services/api';\r\n\r\nexport const fetchPosts = createAsyncThunk('posts/fetchPosts', async () => {\r\n    const [postsResponse, usersResponse] = await Promise.all([\r\n        api.get('/posts'),\r\n        api.get('/users')\r\n    ]);\r\n    const posts = postsResponse.data;\r\n    const users = usersResponse.data;\r\n    return posts.map(post => ({\r\n        ...post,\r\n        user: users.find(u => String(u.id) === String(post.userId))\r\n    }));\r\n});\r\n\r\nexport const createPost = createAsyncThunk('posts/createPost', async (newPost, { getState }) => {\r\n    const response = await api.post('/posts', newPost);\r\n    const currentUser = getState().auth.currentUser;\r\n    return { ...response.data, user: currentUser };\r\n});\r\n\r\nexport const updatePost = createAsyncThunk('posts/updatePost', async ({ id, data }) => {\r\n    const response = await api.patch(`/posts/${id}`, data);\r\n    return response.data;\r\n});\r\n\r\nexport const deletePost = createAsyncThunk('posts/deletePost', async (id) => {\r\n    await api.delete(`/posts/${id}`);\r\n    return id;\r\n});\r\n\r\nexport const toggleLike = createAsyncThunk('posts/toggleLike', async ({ postId, userId }, { getState }) => {\r\n    const state = getState();\r\n    const post = state.posts.items.find(p => p.id === postId);\r\n    let newLikes = [...post.likes];\r\n\r\n    if (newLikes.includes(userId)) {\r\n        newLikes = newLikes.filter(id => id !== userId);\r\n    } else {\r\n        newLikes.push(userId);\r\n    }\r\n\r\n    const response = await api.patch(`/posts/${postId}`, { likes: newLikes });\r\n    return response.data;\r\n});\r\n\r\nconst postsSlice = createSlice({\r\n    name: 'posts',\r\n    initialState: {\r\n        items: [],\r\n        status: 'idle',\r\n        error: null,\r\n    },\r\n    reducers: {},\r\n    extraReducers: (builder) => {\r\n        builder\r\n            .addCase(fetchPosts.pending, (state) => {\r\n                state.status = 'loading';\r\n            })\r\n            .addCase(fetchPosts.fulfilled, (state, action) => {\r\n                state.status = 'succeeded';\r\n                state.items = action.payload;\r\n            })\r\n            .addCase(fetchPosts.rejected, (state, action) => {\r\n                state.status = 'failed';\r\n                state.error = action.error.message;\r\n            })\r\n            .addCase(createPost.fulfilled, (state, action) => {\r\n                state.items.unshift(action.payload);\r\n            })\r\n            .addCase(updatePost.fulfilled, (state, action) => {\r\n                const index = state.items.findIndex(p => p.id === action.payload.id);\r\n                if (index !== -1) {\r\n                    state.items[index] = { ...state.items[index], ...action.payload };\r\n                }\r\n            })\r\n            .addCase(deletePost.fulfilled, (state, action) => {\r\n                state.items = state.items.filter(p => p.id !== action.payload);\r\n            })\r\n            .addCase(toggleLike.fulfilled, (state, action) => {\r\n                const index = state.items.findIndex(p => p.id === action.payload.id);\r\n                if (index !== -1) state.items[index].likes = action.payload.likes;\r\n            });\r\n    },\r\n});\r\n\r\n// Selectors\r\nexport const selectAllPosts = (state) => state.posts.items;\r\n\r\nexport default postsSlice.reducer;\r\n"],"mappings":"AAAA,SAASA,WAAW,EAAEC,gBAAgB,QAAQ,kBAAkB;AAChE,OAAOC,GAAG,MAAM,oBAAoB;AAEpC,OAAO,MAAMC,UAAU,GAAGF,gBAAgB,CAAC,kBAAkB,EAAE,YAAY;EACvE,MAAM,CAACG,aAAa,EAAEC,aAAa,CAAC,GAAG,MAAMC,OAAO,CAACC,GAAG,CAAC,CACrDL,GAAG,CAACM,GAAG,CAAC,QAAQ,CAAC,EACjBN,GAAG,CAACM,GAAG,CAAC,QAAQ,CAAC,CACpB,CAAC;EACF,MAAMC,KAAK,GAAGL,aAAa,CAACM,IAAI;EAChC,MAAMC,KAAK,GAAGN,aAAa,CAACK,IAAI;EAChC,OAAOD,KAAK,CAACG,GAAG,CAACC,IAAI,KAAK;IACtB,GAAGA,IAAI;IACPC,IAAI,EAAEH,KAAK,CAACI,IAAI,CAACC,CAAC,IAAIC,MAAM,CAACD,CAAC,CAACE,EAAE,CAAC,KAAKD,MAAM,CAACJ,IAAI,CAACM,MAAM,CAAC;EAC9D,CAAC,CAAC,CAAC;AACP,CAAC,CAAC;AAEF,OAAO,MAAMC,UAAU,GAAGnB,gBAAgB,CAAC,kBAAkB,EAAE,OAAOoB,OAAO,EAAE;EAAEC;AAAS,CAAC,KAAK;EAC5F,MAAMC,QAAQ,GAAG,MAAMrB,GAAG,CAACW,IAAI,CAAC,QAAQ,EAAEQ,OAAO,CAAC;EAClD,MAAMG,WAAW,GAAGF,QAAQ,CAAC,CAAC,CAACG,IAAI,CAACD,WAAW;EAC/C,OAAO;IAAE,GAAGD,QAAQ,CAACb,IAAI;IAAEI,IAAI,EAAEU;EAAY,CAAC;AAClD,CAAC,CAAC;AAEF,OAAO,MAAME,UAAU,GAAGzB,gBAAgB,CAAC,kBAAkB,EAAE,OAAO;EAAEiB,EAAE;EAAER;AAAK,CAAC,KAAK;EACnF,MAAMa,QAAQ,GAAG,MAAMrB,GAAG,CAACyB,KAAK,CAAC,UAAUT,EAAE,EAAE,EAAER,IAAI,CAAC;EACtD,OAAOa,QAAQ,CAACb,IAAI;AACxB,CAAC,CAAC;AAEF,OAAO,MAAMkB,UAAU,GAAG3B,gBAAgB,CAAC,kBAAkB,EAAE,MAAOiB,EAAE,IAAK;EACzE,MAAMhB,GAAG,CAAC2B,MAAM,CAAC,UAAUX,EAAE,EAAE,CAAC;EAChC,OAAOA,EAAE;AACb,CAAC,CAAC;AAEF,OAAO,MAAMY,UAAU,GAAG7B,gBAAgB,CAAC,kBAAkB,EAAE,OAAO;EAAE8B,MAAM;EAAEZ;AAAO,CAAC,EAAE;EAAEG;AAAS,CAAC,KAAK;EACvG,MAAMU,KAAK,GAAGV,QAAQ,CAAC,CAAC;EACxB,MAAMT,IAAI,GAAGmB,KAAK,CAACvB,KAAK,CAACwB,KAAK,CAAClB,IAAI,CAACmB,CAAC,IAAIA,CAAC,CAAChB,EAAE,KAAKa,MAAM,CAAC;EACzD,IAAII,QAAQ,GAAG,CAAC,GAAGtB,IAAI,CAACuB,KAAK,CAAC;EAE9B,IAAID,QAAQ,CAACE,QAAQ,CAAClB,MAAM,CAAC,EAAE;IAC3BgB,QAAQ,GAAGA,QAAQ,CAACG,MAAM,CAACpB,EAAE,IAAIA,EAAE,KAAKC,MAAM,CAAC;EACnD,CAAC,MAAM;IACHgB,QAAQ,CAACI,IAAI,CAACpB,MAAM,CAAC;EACzB;EAEA,MAAMI,QAAQ,GAAG,MAAMrB,GAAG,CAACyB,KAAK,CAAC,UAAUI,MAAM,EAAE,EAAE;IAAEK,KAAK,EAAED;EAAS,CAAC,CAAC;EACzE,OAAOZ,QAAQ,CAACb,IAAI;AACxB,CAAC,CAAC;AAEF,MAAM8B,UAAU,GAAGxC,WAAW,CAAC;EAC3ByC,IAAI,EAAE,OAAO;EACbC,YAAY,EAAE;IACVT,KAAK,EAAE,EAAE;IACTU,MAAM,EAAE,MAAM;IACdC,KAAK,EAAE;EACX,CAAC;EACDC,QAAQ,EAAE,CAAC,CAAC;EACZC,aAAa,EAAGC,OAAO,IAAK;IACxBA,OAAO,CACFC,OAAO,CAAC7C,UAAU,CAAC8C,OAAO,EAAGjB,KAAK,IAAK;MACpCA,KAAK,CAACW,MAAM,GAAG,SAAS;IAC5B,CAAC,CAAC,CACDK,OAAO,CAAC7C,UAAU,CAAC+C,SAAS,EAAE,CAAClB,KAAK,EAAEmB,MAAM,KAAK;MAC9CnB,KAAK,CAACW,MAAM,GAAG,WAAW;MAC1BX,KAAK,CAACC,KAAK,GAAGkB,MAAM,CAACC,OAAO;IAChC,CAAC,CAAC,CACDJ,OAAO,CAAC7C,UAAU,CAACkD,QAAQ,EAAE,CAACrB,KAAK,EAAEmB,MAAM,KAAK;MAC7CnB,KAAK,CAACW,MAAM,GAAG,QAAQ;MACvBX,KAAK,CAACY,KAAK,GAAGO,MAAM,CAACP,KAAK,CAACU,OAAO;IACtC,CAAC,CAAC,CACDN,OAAO,CAAC5B,UAAU,CAAC8B,SAAS,EAAE,CAAClB,KAAK,EAAEmB,MAAM,KAAK;MAC9CnB,KAAK,CAACC,KAAK,CAACsB,OAAO,CAACJ,MAAM,CAACC,OAAO,CAAC;IACvC,CAAC,CAAC,CACDJ,OAAO,CAACtB,UAAU,CAACwB,SAAS,EAAE,CAAClB,KAAK,EAAEmB,MAAM,KAAK;MAC9C,MAAMK,KAAK,GAAGxB,KAAK,CAACC,KAAK,CAACwB,SAAS,CAACvB,CAAC,IAAIA,CAAC,CAAChB,EAAE,KAAKiC,MAAM,CAACC,OAAO,CAAClC,EAAE,CAAC;MACpE,IAAIsC,KAAK,KAAK,CAAC,CAAC,EAAE;QACdxB,KAAK,CAACC,KAAK,CAACuB,KAAK,CAAC,GAAG;UAAE,GAAGxB,KAAK,CAACC,KAAK,CAACuB,KAAK,CAAC;UAAE,GAAGL,MAAM,CAACC;QAAQ,CAAC;MACrE;IACJ,CAAC,CAAC,CACDJ,OAAO,CAACpB,UAAU,CAACsB,SAAS,EAAE,CAAClB,KAAK,EAAEmB,MAAM,KAAK;MAC9CnB,KAAK,CAACC,KAAK,GAAGD,KAAK,CAACC,KAAK,CAACK,MAAM,CAACJ,CAAC,IAAIA,CAAC,CAAChB,EAAE,KAAKiC,MAAM,CAACC,OAAO,CAAC;IAClE,CAAC,CAAC,CACDJ,OAAO,CAAClB,UAAU,CAACoB,SAAS,EAAE,CAAClB,KAAK,EAAEmB,MAAM,KAAK;MAC9C,MAAMK,KAAK,GAAGxB,KAAK,CAACC,KAAK,CAACwB,SAAS,CAACvB,CAAC,IAAIA,CAAC,CAAChB,EAAE,KAAKiC,MAAM,CAACC,OAAO,CAAClC,EAAE,CAAC;MACpE,IAAIsC,KAAK,KAAK,CAAC,CAAC,EAAExB,KAAK,CAACC,KAAK,CAACuB,KAAK,CAAC,CAACpB,KAAK,GAAGe,MAAM,CAACC,OAAO,CAAChB,KAAK;IACrE,CAAC,CAAC;EACV;AACJ,CAAC,CAAC;;AAEF;AACA,OAAO,MAAMsB,cAAc,GAAI1B,KAAK,IAAKA,KAAK,CAACvB,KAAK,CAACwB,KAAK;AAE1D,eAAeO,UAAU,CAACmB,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}