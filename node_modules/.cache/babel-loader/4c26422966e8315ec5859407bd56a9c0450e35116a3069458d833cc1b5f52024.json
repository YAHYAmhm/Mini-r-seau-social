{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport api from '../../services/api';\nexport const fetchPosts = createAsyncThunk('posts/fetchPosts', async () => {\n  const response = await api.get('/posts?_expand=user');\n  return response.data;\n});\nexport const createPost = createAsyncThunk('posts/createPost', async (newPost, {\n  getState\n}) => {\n  const response = await api.post('/posts', newPost);\n  const currentUser = getState().auth.currentUser;\n  return {\n    ...response.data,\n    user: currentUser\n  };\n});\nexport const updatePost = createAsyncThunk('posts/updatePost', async ({\n  id,\n  data\n}) => {\n  const response = await api.patch(`/posts/${id}`, data);\n  return response.data;\n});\nexport const deletePost = createAsyncThunk('posts/deletePost', async id => {\n  await api.delete(`/posts/${id}`);\n  return id;\n});\nexport const toggleLike = createAsyncThunk('posts/toggleLike', async ({\n  postId,\n  userId\n}, {\n  getState\n}) => {\n  const state = getState();\n  const post = state.posts.items.find(p => p.id === postId);\n  let newLikes = [...post.likes];\n  if (newLikes.includes(userId)) {\n    newLikes = newLikes.filter(id => id !== userId);\n  } else {\n    newLikes.push(userId);\n  }\n  const response = await api.patch(`/posts/${postId}`, {\n    likes: newLikes\n  });\n  return response.data;\n});\nconst postsSlice = createSlice({\n  name: 'posts',\n  initialState: {\n    items: [],\n    status: 'idle',\n    error: null\n  },\n  reducers: {},\n  extraReducers: builder => {\n    builder.addCase(fetchPosts.fulfilled, (state, action) => {\n      state.status = 'succeeded';\n      state.items = action.payload;\n    }).addCase(createPost.fulfilled, (state, action) => {\n      state.items.unshift(action.payload);\n    }).addCase(updatePost.fulfilled, (state, action) => {\n      const index = state.items.findIndex(p => p.id === action.payload.id);\n      if (index !== -1) state.items[index] = action.payload;\n    }).addCase(deletePost.fulfilled, (state, action) => {\n      state.items = state.items.filter(p => p.id !== action.payload);\n    }).addCase(toggleLike.fulfilled, (state, action) => {\n      const index = state.items.findIndex(p => p.id === action.payload.id);\n      if (index !== -1) state.items[index].likes = action.payload.likes;\n    });\n  }\n});\n\n// Selectors\nexport const selectAllPosts = state => state.posts.items;\nexport default postsSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","api","fetchPosts","response","get","data","createPost","newPost","getState","post","currentUser","auth","user","updatePost","id","patch","deletePost","delete","toggleLike","postId","userId","state","posts","items","find","p","newLikes","likes","includes","filter","push","postsSlice","name","initialState","status","error","reducers","extraReducers","builder","addCase","fulfilled","action","payload","unshift","index","findIndex","selectAllPosts","reducer"],"sources":["C:/Users/pc/Documents/03-12-24/03-12-24/src/features/posts/postsSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport api from '../../services/api';\r\n\r\nexport const fetchPosts = createAsyncThunk('posts/fetchPosts', async () => {\r\n    const response = await api.get('/posts?_expand=user');\r\n    return response.data;\r\n});\r\n\r\nexport const createPost = createAsyncThunk('posts/createPost', async (newPost, { getState }) => {\r\n    const response = await api.post('/posts', newPost);\r\n    const currentUser = getState().auth.currentUser;\r\n    return { ...response.data, user: currentUser };\r\n});\r\n\r\nexport const updatePost = createAsyncThunk('posts/updatePost', async ({ id, data }) => {\r\n    const response = await api.patch(`/posts/${id}`, data);\r\n    return response.data;\r\n});\r\n\r\nexport const deletePost = createAsyncThunk('posts/deletePost', async (id) => {\r\n    await api.delete(`/posts/${id}`);\r\n    return id;\r\n});\r\n\r\nexport const toggleLike = createAsyncThunk('posts/toggleLike', async ({ postId, userId }, { getState }) => {\r\n    const state = getState();\r\n    const post = state.posts.items.find(p => p.id === postId);\r\n    let newLikes = [...post.likes];\r\n\r\n    if (newLikes.includes(userId)) {\r\n        newLikes = newLikes.filter(id => id !== userId);\r\n    } else {\r\n        newLikes.push(userId);\r\n    }\r\n\r\n    const response = await api.patch(`/posts/${postId}`, { likes: newLikes });\r\n    return response.data;\r\n});\r\n\r\nconst postsSlice = createSlice({\r\n    name: 'posts',\r\n    initialState: {\r\n        items: [],\r\n        status: 'idle',\r\n        error: null,\r\n    },\r\n    reducers: {},\r\n    extraReducers: (builder) => {\r\n        builder\r\n            .addCase(fetchPosts.fulfilled, (state, action) => {\r\n                state.status = 'succeeded';\r\n                state.items = action.payload;\r\n            })\r\n            .addCase(createPost.fulfilled, (state, action) => {\r\n                state.items.unshift(action.payload);\r\n            })\r\n            .addCase(updatePost.fulfilled, (state, action) => {\r\n                const index = state.items.findIndex(p => p.id === action.payload.id);\r\n                if (index !== -1) state.items[index] = action.payload;\r\n            })\r\n            .addCase(deletePost.fulfilled, (state, action) => {\r\n                state.items = state.items.filter(p => p.id !== action.payload);\r\n            })\r\n            .addCase(toggleLike.fulfilled, (state, action) => {\r\n                const index = state.items.findIndex(p => p.id === action.payload.id);\r\n                if (index !== -1) state.items[index].likes = action.payload.likes;\r\n            });\r\n    },\r\n});\r\n\r\n// Selectors\r\nexport const selectAllPosts = (state) => state.posts.items;\r\n\r\nexport default postsSlice.reducer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}